# US-002: Data Fetch & Ingest Bootstrap

**Status:** tested
**Model:** sonnet
**Component:** System
**Depends On:** US-001
**Traces To:** FR-047, DR-001, DR-002, DR-003, DR-004

## Description

Implements the ingest module that loads all four rhowardstone JSON export files from the `data/` directory into SQLite working tables at startup. The module validates record counts on load and fails with a descriptive, human-readable error if any required file is missing. This story is the data foundation that enables the Database Adapter (US-004) and all work unit generation.

## Files to Create / Modify

- `src/sefi/db/ingest.py` — `IngestManager` class with `ingest_all()` method and individual `ingest_*` methods per file
- `tests/unit/test_ingest.py` — unit tests for record count validation, missing-file error behavior, and happy-path ingestion

## Acceptance Criteria

- [ ] `ingest_all()` loads all four files and returns a dict of `{table_name: record_count}` (FR-047)
- [ ] Ingesting `persons_registry.json` returns a record count of 1,614 (DR-001)
- [ ] Ingesting `knowledge_graph_relationships.json` returns a record count of 2,096 (DR-002)
- [ ] Ingesting `efta_dataset_mapping.json` successfully populates a working table usable for EFTA range lookups (DR-003)
- [ ] Ingesting `knowledge_graph_entities.json` returns a record count of 524 (DR-004)
- [ ] If any of the four files is absent from `data/`, the ingest raises an exception whose message names the missing file specifically (FR-047)
- [ ] Record counts are logged at INFO level after each file is loaded (FR-047)
- [ ] All SQL uses parameterized `?` placeholders; no string interpolation into SQL (NFR-004)
- [ ] All functions include type annotations and docstrings (NFR-002, NFR-008)

## Notes

- The ingest target is an in-process SQLite connection (can be `:memory:` for tests or a real file path from `AppConfig`).
- Each JSON file maps to a dedicated working table: `persons`, `entities`, `relationships`, `efta_mapping`.
- For `efta_dataset_mapping.json`: inspect the actual file structure once available; the mapping format (ranges vs flat) will determine the working-table schema. Implement a fallback that stores the raw JSON blob per record if the structure is non-tabular.
- Do NOT download the 6GB corpus — only the four small JSON files listed are in scope (ROADMAP.md Zero-Corpus note).
- Entity type breakdown after ingest should be loggable: 489 people, 12 shell companies, 9 orgs, 7 properties, 4 aircraft, 3 locations (DR-004 ±5 tolerance).
